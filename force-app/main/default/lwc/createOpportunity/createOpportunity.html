<template>
    <lightning-modal-header label={modalTitle}></lightning-modal-header>

    <lightning-modal-body>
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
        </template>

        <div class="slds-grid slds-wrap slds-gutters slds-p-around_medium">
            <!-- Read-only context (no editing for Account/Owner) -->
            <div class="slds-col slds-size_1-of-2">
                <lightning-input label="Account Name" value={accountName} disabled></lightning-input>
            </div>
            <div class="slds-col slds-size_1-of-2">
                <lightning-input label="Opportunity Owner" value={ownerName} disabled></lightning-input>
            </div>

            <!-- Core fields -->
            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    label="Opportunity Name"
                    data-field="Name"
                    value={oppRecord.Name}
                    onchange={handleChange}
                    required>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="date"
                    label="Close Date"
                    data-field="CloseDate"
                    value={oppRecord.CloseDate}
                    onchange={handleChange}
                    required>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Stage"
                    data-field="StageName"
                    value={oppRecord.StageName}
                    options={stageOptions}
                    onchange={handleChange}
                    required>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="number"
                    label="Probability (%)"
                    data-field="Probability"
                    value={oppRecord.Probability}
                    min="0" max="100"
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="number"
                    label="Amount"
                    data-field="Amount"
                    value={oppRecord.Amount}
                    formatter="currency"
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <!-- Business fields (dynamic picklists) -->
            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Type"
                    data-field="Type"
                    value={oppRecord.Type}
                    options={typeOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Opportunity Type"
                    data-field="Opportunity_Type__c"
                    value={oppRecord.Opportunity_Type__c}
                    options={opportunityTypeOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Channel"
                    data-field="Channel__c"
                    value={oppRecord.Channel__c}
                    options={channelOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Geography"
                    data-field="Geography__c"
                    value={oppRecord.Geography__c}
                    options={geographyOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Direct/Indirect"
                    data-field="Direct_Indirect__c"
                    value={oppRecord.Direct_Indirect__c}
                    options={directIndirectOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Business Type"
                    data-field="Business_Type__c"
                    value={oppRecord.Business_Type__c}
                    options={businessTypeOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Contact Type"
                    data-field="Contact_type__c"
                    value={oppRecord.Contact_type__c}
                    options={contactTypeOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Offering"
                    data-field="Offering__c"
                    value={oppRecord.Offering__c}
                    options={offeringOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <!-- Other fields -->
            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="number"
                    label="Number of Resources"
                    data-field="Number_of_Resources__c"
                    value={oppRecord.Number_of_Resources__c}
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-combobox
                    label="Type of Engagement"
                    data-field="Type_of_Engagement__c"
                    value={oppRecord.Type_of_Engagement__c}
                    options={typeOfEngagementOptions}
                    onchange={handleChange}>
                </lightning-combobox>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="date"
                    label="Start Date"
                    data-field="Start_Date__c"
                    value={oppRecord.Start_Date__c}
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-2">
                <lightning-input
                    type="date"
                    label="End Date"
                    data-field="End_Date__c"
                    value={oppRecord.End_Date__c}
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-1">
                <lightning-input
                    label="Project Code"
                    data-field="Project_Code__c"
                    value={oppRecord.Project_Code__c}
                    onchange={handleChange}>
                </lightning-input>
            </div>

            <div class="slds-col slds-size_1-of-1">
                <lightning-textarea
                    label="Description"
                    data-field="Description"
                    value={oppRecord.Description}
                    onchange={handleChange}>
                </lightning-textarea>
            </div>
        </div>
    </lightning-modal-body>

    <lightning-modal-footer>
        <lightning-button variant="neutral" label="Cancel" onclick={handleCancel} disabled={isLoading}></lightning-button>
        <lightning-button variant="brand" label="Save" onclick={handleSave} disabled={isLoading}></lightning-button>
    </lightning-modal-footer>
</template>
